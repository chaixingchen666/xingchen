<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="pragma" content="no-cache"> 
<meta http-equiv="cache-control" content="no-cache"> 
<meta http-equiv="expires" content="0">   
<title>蓝窗首页</title>
<script type="text/javascript" src="/skydesk/js/msgbox.js"></script>
<script type="text/javascript" src="http://win.skydispark.com/skyasset/js/jquery.min.js"></script>
<script type="text/javascript" src="/skydesk/js/jquery.fyutils.js"></script>
<script type="text/javascript" src="http://win.skydispark.com/skyasset/js/amchart/amcharts.js"></script>
<script type="text/javascript" src="http://win.skydispark.com/skyasset/js/amchart/pie.js"></script>
<script type="text/javascript" src="http://win.skydispark.com/skyasset/js/amchart/serial.js"></script>
<link rel="stylesheet"type="text/css" href="/skydesk/css/icon.css" >
<link rel="stylesheet" type="text/css" href="/skydesk/css/msgbox.css"/>
<link rel="stylesheet" type="text/css" href="/skydesk/css/demo.css"/>
<style type="text/css">
* {font-family: "Microsoft YaHei"}
body,html{margin:0px;height:100%}
.msg-left,.msg-xsqs,.quick-channel{background: #fff}
.msg-left{position: absolute;left:0; right: 535px;top:0;bottom:0;padding-bottom: 30px}
.msg-right{position: absolute; width: 520px;top:0;right:0;bottom:0;}
.quick-channel{position: absolute;bottom: 10px;top: 370px;}
.msg-data-ul li,.msg-xsqs-title,.quick-ul li{color:#323232;font-size:20px}
.msg-date,.msg-chart,.msg-data{border-bottom: 1px solid #c3c3c3;margin-left: 32px;position: relative;}
.msg-chart-div{position: absolute;right: 300px;left:0;bottom:0;top:0}
.xsmsg-div{position: absolute;width: 300px;right:0}
.xsmsg-title {padding: 10px 0;}
.xsmsg-text {background: #00929a;color: #fff;font-size: 24px;width: 180px;border-radius: 5px;padding: 5px;position: relative;}
.xsmsg-text:after {position: absolute;right: 8px;font-size: 14px;bottom:8px}
.xsmsgcurr:after {content: "元";}
.xsmsgrate:after {content: "百分比";}
.msg-chart,.msg-xsqs-chart,.pie-chart{height: 300px}
.pie-chart{width: 50%;float: left;}
.msg-title{color:#b7b7b7;font-size: 16px}
.msg-text,.quick-title{color: #0092a2;font-size: 20px}
.msg-date-ul li,.msg-data-ul li,.quick-ul li,.msg-title,.msg-text{text-align: center;}
.msg-date-ul li{padding:15px 0;width:80px;height:25px};
.msg-date,.msg-data-ul{margin-top: 10px}
.msg-date-ul li{border: 1px solid #fff}
.msg-date-ul,.msg-data-ul,.quick-ul{overflow: hidden;zoom:1}
.msg-date-ul li,.msg-data-ul li,.quick-ul li{float: left;}
.msg-data-ul li{width:140px;height:25px}
.quick-ul li{width:100px;background-color: #f2f2f2;padding: 3px;font-size: 16px;margin: 5px 10px;cursor: pointer;}
.quick-ul li:hover{color: #ff7900}
.quick-title{clear: both;height: 40px;line-height: 40px}
.msg-date-ul li.checked,.msg-date-ul li[data-dateid]:hover{border-bottom: 1px solid #ff7900;color: #ff7900}
.msglabel{height: 30px;line-height:30px;width:65px;font-size: 18px;color: #fff;margin-top: 5px;display: inline-block;cursor:pointer;border-radius: 15px 0 0 15px}
.xslabel{background-color: #00bed3}
.kclabel{background-color: #0093d4}
.viplabel{background-color: #eb9f4a}
.msg-data-div:not(:last-child){border-bottom: 1px dashed #c3c3c3}
.msg-data-ul li:not(:last-child){border-right: 1px dashed #c3c3c3}
.msg-data-ul li{height: 45px;margin: 15px 0}
.msg-xsqs{margin-bottom: 15px}
.msg-xsqs-title,.quick-title{height: 53px;line-height: 53px;text-indent: 20px}
</style>
</head>
<body style="overflow: auto;min-width: 1300px;position: relative;">
<div class="msg-left">
<div class="msg-date">
<ul class="msg-date-ul">
<li data-dateid=0 class="checked">
今日
</li>
<li data-dateid=1>
昨日
</li>
<li data-dateid=2>
本周
</li>
<li data-dateid=3>
本月
</li>
<li>
<input type="button" class="btn1" value="刷新" onclick="top.refreshMainPage()" />
</li>
</ul>
</div>
<div class="msg-chart">
<div class="msg-chart-div">
<div id="brandkcchart" class="pie-chart">
</div>
<div id="housesalechart" class="pie-chart">
</div>
</div>
<div class="xsmsg-div">
<div class="xsmsg-title">
销售完成
</div>
<div class="xsmsg-text xsmsgcurr" id="xswccurr">
0.00
</div>
<div class="xsmsg-title">
销售计划
</div>
<div class="xsmsg-text xsmsgcurr" id="xsjhcurr">
0.00
</div>
<div class="xsmsg-title">
销售完成率
</div>
<div class="xsmsg-text xsmsgrate" id="jhwcrate">
100
</div>
</div>
</div>
<div class="msg-data">
<!-- 销售 -->
<div class="msg-data-div">
<ul class="msg-data-ul">
<li>
<label class="msglabel xslabel" data-pgid="pg1703" title="打开销售汇总分析">
销售
</label>
</li>
<li>
<p class="msg-title">开单数</p>
<p class="msg-text" id="xsnum">0</p>
</li>
<li>
<p class="msg-title">销售量</p>
<p class="msg-text" id="xsamt">0</p>
</li>
<li>
<p class="msg-title">销售额</p>
<p class="msg-text" id="xscurr">0</p>
</li>
<li>
<p class="msg-title">平均折扣</p>
<p class="msg-text" id="discount">0</p>
</li>
<li>
<p class="msg-title">平均单价</p>
<p class="msg-text" id="xsprice">0</p>
</li>
<li>
<p class="msg-title">SKC</p>
<p class="msg-text" id="xsskc">0</p>
</li>
</ul>
</div>
<!-- 库存 -->
<div class="msg-data-div">
<ul class="msg-data-ul">
<li>
<label class="msglabel kclabel" data-pgid="pg1504" title="打开库存资源明细">
库存
</label>
</li>
<li>
<p class="msg-title">库存数</p>
<p class="msg-text" id="kcamt">0</p>
</li>
<li>
<p class="msg-title">库存SKC</p>
<p class="msg-text" id="kcskc">0</p>
</li>
<li>
<p class="msg-title">进货数</p>
<p class="msg-text" id="rknum">0</p>
</li>
<li>
<p class="msg-title">库存单价</p>
<p class="msg-text" id="kcprice">0</p>
</li>
<li>
<p class="msg-title">库存金额</p>
<p class="msg-text" id="kccurr">0</p>
</li>
</ul>
</div>
<!-- 会员 -->
<div class="msg-data-div">
<ul class="msg-data-ul">
<li>
<label class="msglabel viplabel" data-pgid="pg1804" title="打开会员档案">
会员
</label>
</li>
<li>
<p class="msg-title">新增会员</p>
<p class="msg-text" id="newvipnum">0</p>
</li>
<li>
<p class="msg-title">平均折扣</p>
<p class="msg-text" id="vipdiscount">0</p>
</li>
<li>
<p class="msg-title">会员消费金额</p>
<p class="msg-text" id="vipxscurr">0</p>
</li>
<li>
<p class="msg-title">会员消费占比</p>
<p class="msg-text" id="vipxsrate">0</p>
</li>
<li>
<p class="msg-title">会员消费次数</p>
<p class="msg-text" id="vipxsnum">0</p>
</li>
<li>
<p class="msg-title">会员活跃度</p>
<p class="msg-text" id="vipactive">0</p>
</li>
</ul>
</div>

</div>
</div>

<div class="msg-right">
<div class="msg-xsqs">
<div class="msg-xsqs-title">
近8天的销售趋势
</div>
<div class="msg-xsqs-chart" id="xsqschart">
</div>
</div>

<div class="quick-channel">
<!-- 最近使用的 -->
<div class="quick-title">最近使用</div>
<ul class="quick-ul" id="quickul">
<li data-pgid="pg1201">
零售开票
</li>
<li data-pgid="pg1302">
批发开票
</li>
<li data-pgid="pg1303">
批发退货
</li>
<li data-pgid="pg1607">
收款及折让
</li>
<li data-pgid="pg1608">
销售费用
</li>
<li data-pgid="pg1102">
采购入库
</li>
<li data-pgid="pg1103">
采购退货
</li>
<li data-pgid="pg1402">
调拨出库
</li>
<li data-pgid="pg1403">
调拨入库
</li>
</ul>
<!-- 经常使用的 -->
<div class="quick-title hide">快捷入口</div>
<ul class="quick-ul hide">
<li>
零售开票
</li>
<li>
批发开票
</li>
<li>
批发退库
</li>
<li>
销售退款
</li>
<li>
销售费用
</li>
<li>
销售管理
</li>
<li>
调拨出库
</li>
<li>
调拨入库
</li>
</ul>
</div>
</div>
<script type="text/javascript">
var skyuser = getCookieObj("SKYSTR");
var levelid = Number(getValuebyName("GLEVELID"));
var houseid = Number(getValuebyName("HOUSEID"));
$(function(){
	$("body").show();
	$(".msg-date-ul li").click(function(e){
		var dateid = $(this).data("dateid");
		if(!isNaN(dateid)){
			$(".msg-date-ul li.checked").removeClass("checked");
			$(this).addClass("checked");
			totalfirstpage(dateid);
		}
	});
	totalfirstpage(0);
	nearlogin();
	$("body").delegate("[data-pgid]","click",function(){
		var $this = $(this);
		var pgid = $this.data("pgid");
		if(top.$("#"+pgid).length==1) top.$("#"+pgid).click();
	});
});
// glevelid: 0=系统管理员,1=店员,2=店长,3=财务,4=经理,5=老板,6=督导,7=收银员,8=AD客服,9=库管
// dateid:0=本日，1=昨日，2=近7日，3=近30日
function totalfirstpage(dateid){
	alertmsg(6);
	$.ajax({
		type: "POST",
		//访问WebService使用Post方式请求 
		url: "/skydesk/fyjerp",
		//调用WebService的地址和方法名称组合 ---- WsURL/方法名 
		data: {
			erpser: "totalfirstpage",
			glevelid: levelid,
			houseid: houseid,
			dateid: dateid
		},
		//这里是要传递的参数，格式为 data: "{paraName:paraValue}",下面将会看到                          
		dataType: 'json',
		success: function(data) { //回调函数，result，返回值 
			try {
				if (valideData(data)) {
					var xsnum = data.XSNUM; //销售单数
					$("#xsnum").html(Number(xsnum));
					var xsamt = data.XSAMT; //销售数量
					$("#xsamt").html(Number(xsamt));
					var xscurr = data.XSCURR; //销售金额
					$("#xscurr,#xswccurr").html(Number(xscurr).toFixed(2));
					var discount = data.DISCOUNT; //平均折扣
					$("#discount").html(Number(discount).toFixed(2));
					var xsprice = data.XSPRICE; //平均单价
					$("#xsprice").html(Number(xsprice).toFixed(2));
					var xsskc = data.XSSKC; //平均SKC
					$("#xsskc").html(Number(xsskc));
					var newvipnum = data.NEWVIPNUM; //新增会员
					$("#newvipnum").html(Number(newvipnum));
// 					var vipxsamt = data.VIPXSAMT; //会员销售量
// 					$("#vipxsamt").html(Number(vipxsamt));
					var vipxscurr = data.VIPXSCURR; //会员销售额
					$("#vipxscurr").html(Number(vipxscurr).toFixed(2));
					var vipxsrate = data.VIPXSRATE; //会员销售占比
					$("#vipxsrate").html(Number(vipxsrate).toFixed(2));
					var vipxsnum = data.VIPXSNUM; //会员销售单
					$("#vipxsnum").html(Number(vipxsnum));
					var vipdiscount = data.VIPDISCOUNT; //会员平均折扣
					$("#vipdiscount").html(Number(vipdiscount).toFixed(2));
					var vipactive = data.VIPACTIVE; //会员活跃度
					$("#vipactive").html(Number(vipactive).toFixed(2));
					var kcamt = data.KCAMT; //库存数
					$("#kcamt").html(Number(kcamt));
					var kccurr = data.KCCURR; //库存金额
					$("#kccurr").html(Number(kccurr).toFixed(2));
					var kcprice = data.KCPRICE; //库存单价
					$("#kcprice").html(Number(kcprice).toFixed(2));
					var kcskc = data.KCSKC; //库存SKC
					$("#kcskc").html(Number(kcskc));
					var rknum = data.RKNUM; //入库数
					$("#rknum").html(Number(rknum));
					var xsjhcurr = data.XSJHCURR; //销售计划金额
					$("#xsjhcurr").html(Number(xsjhcurr).toFixed(2));
					var jhwcrate = data.JHWCRATE; //销售计划完成占比
					$("#jhwcrate").html(jhwcrate);
					var brandkclist = data.brandkclist; //品牌库存占比
					var brandkcChart = AmCharts.makeChart("brandkcchart", {
						type: "pie",
						theme: "patterns",
// 						legend:{
// 						   	position:"right",
// 						    marginRight:100,
// 						    autoMargins:false
// 						  },
						innerRadius: "30%",
						groupPercent: 0.1,
						dataProvider: brandkclist,
						titleField: "BRANDNAME",
						valueField: "AMOUNT",
						startDuration: 0.01,
						outlineThickness: 2,
						colors: amchartcolors,
						labelsEnabled: false,
						titles: [
							{
								text: "品牌库存占比",
								size: 15
							}
						]
					});
					var housetop10list = data.housetop10list; //店铺销售占比
					var housesaleChart = AmCharts.makeChart("housesalechart", {
						type: "pie",
						theme: "patterns",
						innerRadius: "30%",
						groupPercent: 0.1,
						dataProvider: housetop10list,
						titleField: "HOUSENAME",
						valueField: "CURR",
						innerRadius: "30%",
						startDuration: 0.01,
						outlineThickness: 2,
						colors: amchartcolors,
						labelsEnabled: false,
						titles: [
							{
								text: "店铺销售占比",
								size: 15
							}
						]
					});
					var saleday7list = data.saleday7list; //近8天销售趋势
					var saleChart = AmCharts.makeChart("xsqschart",{
						  type: "serial",
						  dataProvider: saleday7list,
						  colors: amchartcolors,
						  valueAxes: [{
							    axisAlpha: 0,
							    position: "left",
							    title: "销售额"
							}],
							startDuration: 1,
							graphs: [{
							    balloonText: "<b>[[category]]: [[value]]</b>",
							    fillColorsField: "color",
							    fillAlphas: 0.9,
							    lineAlpha: 0.2,
							    type: "column",
							    valueField: "CURR"
							  }],
							  chartCursor: {
							    categoryBalloonEnabled: false,
							    cursorAlpha: 0,
							    zoomable: false
							  },
							  categoryField: "DATESTR",
							  categoryAxis: {
							    gridPosition: "start",
							    labelRotation: 45
							  }
						});
					
				}
			} catch(err) {
				console.error(err.message);
			}
		}
	});

}
function nearlogin(){
	alertmsg(6);
	$.ajax({
		type: "POST",
		//访问WebService使用Post方式请求 
		url: "/skydesk/fyjerp",
		//调用WebService的地址和方法名称组合 ---- WsURL/方法名 
		data: {
			erpser: "nearlogin",
			rows: 12
		},
		//这里是要传递的参数，格式为 data: "{paraName:paraValue}",下面将会看到                          
		dataType: 'json',
		success: function(data) { //回调函数，result，返回值 
			try {
				if (valideData(data)) {
					if(data.total>0){
						var rows = data.rows;
						$("#quickul").html("");
						for(var i in rows){
							var row = rows[i];
							$("#quickul").append('<li data-pgid="pg'+row.PROGID+'">'+row.PROGNAME+'</li>');
						}
					}
				}
			} catch(err) {
				console.error(err.message);
			}
		}
	});
}
</script>
</body>
</html>